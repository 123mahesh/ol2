<html>
<head>
<script src="../OLLoader.js"></script>
<script type="text/javascript">

var events, layer1, style, logevt, map, lonlat, pixel, element;

window.onload = init;

function init() {

	element = document.getElementById("map");

	style = new OpenLayers.StyleMap({
		 'default': OpenLayers.Util.applyDefaults(
		     {label: "${l}", pointRadius: 30},
		     OpenLayers.Feature.Vector.style["default"]
		 ),
		 'select': OpenLayers.Util.applyDefaults(
		     {pointRadius: 30},
		     OpenLayers.Feature.Vector.style.select
		 )
	});
	
	layer1 = new OpenLayers.Layer.Vector("Layer 1", {
		 styleMap: style
	});

	layer1.addFeatures([
		 new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POINT(0 0)"), {l:1}),
		 new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POINT(0 0)"), {l:1}),
		 new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POINT(0 0)"), {l:1}),
		 new OpenLayers.Feature.Vector(OpenLayers.Geometry.fromWKT("POINT(0 0)"), {l:1})
	]);

	map = new OpenLayers.Map({
		div: "map",
		allOverlays: true,
		zoom: 6,
		center: [0, 0]
	});
	
	map.addLayers([layer1]);
	
	/**Uncomment to view behavior w/in featureclick.html
	map.events.on({featureclick: logEvent});
	logevt = [];
	events = map.events;
	
	lonlat = new OpenLayers.LonLat(0,0);
	pixel = map.getPixelFromLonLat(lonlat);
	
	trigger('mousedown', pixel);
	trigger('mouseup', pixel);

	alert("logevt length = " + logevt.length);
	//*/
}


function logEvent(e) {

	//alert("Does this happen?");
	logevt.push(e);
}

function trigger(type, pxl) {

	var map_position = OpenLayers.Util.pagePosition(element);

	pxl.x = pxl.x + map_position[0];
	pxl.y = pxl.y + map_position[1];

	events.triggerEvent(type, {
		xy: pxl, 
		clientX: pxl.x, 
		clientY: pxl.y, 
		which: 1  // which == 1 means left-click
	}); 	
}

// TESTS

function test_onClick25(t) {
	window.onload = init();
	t.plan(1);
	logevt = [];
	map.events.on({'featureclick': logEvent});
	events = map.events;
	lonlat = new OpenLayers.LonLat(0,0);
	pixel = map.getPixelFromLonLat(lonlat);
	trigger('mousedown', pixel);
	trigger('mouseup', pixel);
	t.eq(logevt.length, 2, "testing log length");
}

// END TESTS

</script>
</head>
<body onload="init()">
<div id="map" style="width: 600px; height: 300px;"></div>
</body>
</html>
